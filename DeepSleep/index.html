<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation (Wiki) for Tasmota"><link href=https://tasmota.github.io/docs/DeepSleep/ rel=canonical><link rel="shortcut icon" href=../_media/favicon.ico><meta name=generator content="mkdocs-1.1.2, mkdocs-material-6.2.8"><title>DeepSleep - Tasmota</title><link rel=stylesheet href=../assets/stylesheets/main.cb6bc1d0.min.css><link rel=stylesheet href=../assets/stylesheets/palette.39b8e14a.min.css><meta name=theme-color content=#2094f3><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Barlow:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Barlow",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../assets/css/anchor-fix.css><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-140681905-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme=preference data-md-color-primary=blue data-md-color-accent=indigo> <script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#methods-to-temporarly-disable-deepsleep-mode class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://tasmota.github.io/docs/ title=Tasmota class="md-header-nav__button md-logo" aria-label=Tasmota> <img src=../_media/logo.svg alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <div class=md-header-nav__topic> <span class=md-ellipsis> Tasmota </span> </div> <div class=md-header-nav__topic> <span class=md-ellipsis> DeepSleep </span> </div> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/arendst/tasmota/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../Features/ class="md-tabs__link md-tabs__link--active"> Features </a> </li> <li class=md-tabs__item> <a href=../ESP32/ class=md-tabs__link> ESP32 (beta) </a> </li> <li class=md-tabs__item> <a href=../Integrations/ class=md-tabs__link> Smart Home Integrations </a> </li> <li class=md-tabs__item> <a href=../Supported-Peripherals/ class=md-tabs__link> Peripherals </a> </li> <li class=md-tabs__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-tabs__link> Supported Devices </a> </li> <li class=md-tabs__item> <a href=../FAQ/ class=md-tabs__link> Help </a> </li> <li class=md-tabs__item> <a href=../Builds/ class=md-tabs__link> Builds </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://tasmota.github.io/docs/ title=Tasmota class="md-nav__button md-logo" aria-label=Tasmota> <img src=../_media/logo.svg alt=logo> </a> Tasmota </label> <div class=md-nav__source> <a href=https://github.com/arendst/tasmota/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> arendst/tasmota </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Home <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Home data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> News </a> </li> <li class=md-nav__item> <a href=../About/ class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../Getting-Started/ class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../Upgrading/ class=md-nav__link> Upgrading </a> </li> <li class=md-nav__item> <a href=../MQTT/ class=md-nav__link> MQTT </a> </li> <li class=md-nav__item> <a href=../Commands/ class=md-nav__link> Commands </a> </li> <li class=md-nav__item> <a href=../Templates/ class=md-nav__link> Templates </a> </li> <li class=md-nav__item> <a href=../Components/ class=md-nav__link> Components </a> </li> <li class=md-nav__item> <a href=../Modules/ class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=../Peripherals/ class=md-nav__link> Peripherals </a> </li> <li class=md-nav__item> <a href=../WebUI/ class=md-nav__link> WebUI </a> </li> <li class=md-nav__item> <a href=../Compile-your-build/ class=md-nav__link> Compiling </a> </li> <li class=md-nav__item> <a href=../Contributing/ class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=../Download/ class=md-nav__link> Download </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/discussions/categories/show-and-tell class=md-nav__link> Project Showcase </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Features <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Features data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Features/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../ADC/ class=md-nav__link> Analog pin </a> </li> <li class=md-nav__item> <a href=../ble/Bluetooth-Esp32/ class=md-nav__link> Bluetooth ESP32 </a> </li> <li class=md-nav__item> <a href=../ble/Bluetooth-Esp8266/ class=md-nav__link> Bluetooth ESP8266 </a> </li> <li class=md-nav__item> <a href=../Buttons-and-Switches/ class=md-nav__link> Buttons and Switches </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> DeepSleep <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> DeepSleep </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#methods-to-temporarly-disable-deepsleep-mode class=md-nav__link> Methods to (temporarly) disable DeepSleep mode </a> <nav class=md-nav aria-label="Methods to (temporarly) disable DeepSleep mode"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#using-a-switch class=md-nav__link> Using a switch </a> </li> <li class=md-nav__item> <a href=#using-mqtt class=md-nav__link> Using MQTT </a> </li> <li class=md-nav__item> <a href=#using-smart-home-automation class=md-nav__link> Using smart home automation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#driver-writer-executing-commands-before-entering-deepsleep class=md-nav__link> Driver writer: Executing commands before entering DeepSleep </a> </li> <li class=md-nav__item> <a href=#overcome-network-issues class=md-nav__link> Overcome network issues </a> </li> <li class=md-nav__item> <a href=#deepsleep-algorithm-general-timing class=md-nav__link> DeepSleep Algorithm General Timing </a> </li> <li class=md-nav__item> <a href=#esp8266-deepsleep-side-effects class=md-nav__link> ESP8266 DeepSleep Side-effects </a> </li> <li class=md-nav__item> <a href=#log-output-explanation class=md-nav__link> Log Output Explanation </a> </li> <li class=md-nav__item> <a href=#rules-to-adapt-deepsleep-period-to-battery-level class=md-nav__link> Rules to adapt DeepSleep period to battery level. </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Device-Groups/ class=md-nav__link> Device Groups </a> </li> <li class=md-nav__item> <a href=../Displays/ class=md-nav__link> Displays </a> </li> <li class=md-nav__item> <a href=../Dynamic-Sleep/ class=md-nav__link> Dynamic Sleep </a> </li> <li class=md-nav__item> <a href=../I2CDevices/ class=md-nav__link> I2C Devices </a> </li> <li class=md-nav__item> <a href=../Tasmota-IR/ class=md-nav__link> IR Communication </a> </li> <li class=md-nav__item> <a href=../Lights/ class=md-nav__link> Lights </a> </li> <li class=md-nav__item> <a href=../OpenTherm/ class=md-nav__link> OpenTherm </a> </li> <li class=md-nav__item> <a href=../PIR-Motion-Sensors/ class=md-nav__link> PIR Motion Sensors </a> </li> <li class=md-nav__item> <a href=../Power-Monitoring-Calibration/ class=md-nav__link> Power Monitoring Calibration </a> </li> <li class=md-nav__item> <a href=../PWM-dimmer-switch/ class=md-nav__link> PWM Dimmer </a> </li> <li class=md-nav__item> <a href=../RF-Protocol/ class=md-nav__link> RF Communication </a> </li> <li class=md-nav__item> <a href=../Rules/ class=md-nav__link> Rules </a> </li> <li class=md-nav__item> <a href=../Scripting-Language/ class=md-nav__link> Scripting </a> </li> <li class=md-nav__item> <a href=../Serial-to-TCP-Bridge/ class=md-nav__link> Serial to TCP Bridge </a> </li> <li class=md-nav__item> <a href=../Blinds-and-Shutters/ class=md-nav__link> Shutters and Blinds </a> </li> <li class=md-nav__item> <a href=../Smart-Meter-Interface/ class=md-nav__link> Smart Meter Interface </a> </li> <li class=md-nav__item> <a href=../Subscribe-%26-Unsubscribe/ class=md-nav__link> Subscribe & Unsubscribe </a> </li> <li class=md-nav__item> <a href=../TasmotaClient/ class=md-nav__link> TasmotaClient </a> </li> <li class=md-nav__item> <a href=../Thermostat/ class=md-nav__link> Thermostat </a> </li> <li class=md-nav__item> <a href=../Timers/ class=md-nav__link> Timers </a> </li> <li class=md-nav__item> <a href=../TLS/ class=md-nav__link> TLS Secured MQTT </a> </li> <li class=md-nav__item> <a href=../TuyaMCU/ class=md-nav__link> TuyaMCU </a> </li> <li class=md-nav__item> <a href=../Zigbee/ class=md-nav__link> Zigbee </a> </li> <li class=md-nav__item> <a href=../Tutorials/ class=md-nav__link> Projects and Tutorials </a> </li> <li class=md-nav__item> <a href=../For-Developers/ class=md-nav__link> For Developers </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../ESP32/ class=md-nav__link> ESP32 (beta) </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Smart Home Integrations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Smart Home Integrations" data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"></span> Smart Home Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Integrations/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../Alexa/ class=md-nav__link> Alexa </a> </li> <li class=md-nav__item> <a href=../AWS-IoT/ class=md-nav__link> AWS IoT </a> </li> <li class=md-nav__item> <a href=../Domoticz/ class=md-nav__link> Domoticz </a> </li> <li class=md-nav__item> <a href=../Home-Assistant/ class=md-nav__link> Home Assistant </a> </li> <li class=md-nav__item> <a href=../Homebridge/ class=md-nav__link> Homebridge </a> </li> <li class=md-nav__item> <a href=../HomeSeer/ class=md-nav__link> HomeSeer </a> </li> <li class=md-nav__item> <a href=../IP-Symcon/ class=md-nav__link> IP Symcon </a> </li> <li class=md-nav__item> <a href=../KNX/ class=md-nav__link> KNX </a> </li> <li class=md-nav__item> <a href=../NodeRed/ class=md-nav__link> NodeRed </a> </li> <li class=md-nav__item> <a href=../nymea/ class=md-nav__link> nymea </a> </li> <li class=md-nav__item> <a href=../Octoprint/ class=md-nav__link> OctoPrint </a> </li> <li class=md-nav__item> <a href=../openHAB/ class=md-nav__link> openHAB </a> </li> <li class=md-nav__item> <a href=../otto/ class=md-nav__link> Otto </a> </li> <li class=md-nav__item> <a href=https://github.com/arendst/Tasmota/issues/3769 class=md-nav__link> IOBroker </a> </li> <li class=md-nav__item> <a href=https://github.com/tim-hellhake/tasmota-adapter class=md-nav__link> Mozilla WebThings Adapter </a> </li> <li class=md-nav__item> <a href=https://github.com/hongtat/tasmota-connect class=md-nav__link> SmartThings </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Peripherals <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Peripherals data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"></span> Peripherals </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Supported-Peripherals/ class=md-nav__link> Supported Peripherals </a> </li> <li class=md-nav__item> <a href=../Buzzer/ class=md-nav__link> Buzzer </a> </li> <li class=md-nav__item> <a href=../A4988-Stepper-Motor-Controller/ class=md-nav__link> A4988 stepper motor controller </a> </li> <li class=md-nav__item> <a href=../AHT1x/ class=md-nav__link> AHT1x temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../AM2301/ class=md-nav__link> AM2301 temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../APDS-9960/ class=md-nav__link> APDS-9960 light and gesture sensor </a> </li> <li class=md-nav__item> <a href=../AS3935/ class=md-nav__link> AS3935 Franklin Lightning sensor </a> </li> <li class=md-nav__item> <a href=../AZ-7798/ class=md-nav__link> AZ7798 CO<sub>2</sub> meter </a> </li> <li class=md-nav__item> <a href=../BH1750/ class=md-nav__link> BH1750 ambient light sensor </a> </li> <li class=md-nav__item> <a href=../BME280/ class=md-nav__link> BME280 temperature, humidity and pressure sensor </a> </li> <li class=md-nav__item> <a href=../BME680/ class=md-nav__link> BME680 temperature, humidity, pressure and gas sensor </a> </li> <li class=md-nav__item> <a href=../CC2530/ class=md-nav__link> CC253x Zigbee module </a> </li> <li class=md-nav__item> <a href=../Moisture-Sensor-and-Chirp%21-Sensor/ class=md-nav__link> Chirp! moisture sensor </a> </li> <li class=md-nav__item> <a href=../DHT11/ class=md-nav__link> DHT11 temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../DS18x20/ class=md-nav__link> DS18x20 temperature sensor </a> </li> <li class=md-nav__item> <a href=../DS3231/ class=md-nav__link> DS3231 Real Time Clock </a> </li> <li class=md-nav__item> <a href=../EZO/ class=md-nav__link> EZO sensors </a> </li> <li class=md-nav__item> <a href=../HM-10/ class=md-nav__link> HM-10 Bluetooth module </a> </li> <li class=md-nav__item> <a href=../HM-17/ class=md-nav__link> HM-17 Bluetooth module </a> </li> <li class=md-nav__item> <a href=../HC-SR04/ class=md-nav__link> HC-SR04 ultrasonic ranging sensor </a> </li> <li class=md-nav__item> <a href=../Honeywell-HIH/ class=md-nav__link> Honeywell HIH temperature and humidity sensor </a> </li> <li class=md-nav__item> <a href=../IAQ/ class=md-nav__link> iAQ-Core indoor air quality sensor </a> </li> <li class=md-nav__item> <a href=../IR-Remote/ class=md-nav__link> IR Remote </a> </li> <li class=md-nav__item> <a href=../LM75AD/ class=md-nav__link> LM75AD temperature sensor </a> </li> <li class=md-nav__item> <a href=../MCP230xx/ class=md-nav__link> MCP23008 / MCP23017 GPIO Expander </a> </li> <li class=md-nav__item> <a href=../MFRC522/ class=md-nav__link> MFRC522 RFID reader </a> </li> <li class=md-nav__item> <a href=../MGC3130/ class=md-nav__link> MGC3130 3D tracking and gesture controller </a> </li> <li class=md-nav__item> <a href=../MH-Z19B/ class=md-nav__link> MH-Z19B CO<sub>2</sub> Sensor </a> </li> <li class=md-nav__item> <a href=../MLX90614/ class=md-nav__link> MLX90614 infrared thermometer </a> </li> <li class=md-nav__item> <a href=../MLX90640/ class=md-nav__link> MLX90640 Far infrared thermal sensor array </a> </li> <li class=md-nav__item> <a href=../MPR121/ class=md-nav__link> MPR121 capacitive touch sensor </a> </li> <li class=md-nav__item> <a href=../MPU-6050/ class=md-nav__link> MPU-6050 gyroscope and accelerometer </a> </li> <li class=md-nav__item> <a href=../NRF24L01/ class=md-nav__link> NRF24L01 module </a> </li> <li class=md-nav__item> <a href=../OpenTherm/ class=md-nav__link> OpenTherm </a> </li> <li class=md-nav__item> <a href=../P1-Smart-Meter/ class=md-nav__link> P1 Smart Meter </a> </li> <li class=md-nav__item> <a href=../PAJ7620/ class=md-nav__link> PAJ7620U2 gesture sensor </a> </li> <li class=md-nav__item> <a href=../PCA9685/ class=md-nav__link> PCA9685 12-bit PWM controller </a> </li> <li class=md-nav__item> <a href=../PN532/ class=md-nav__link> PN532 NFC reader </a> </li> <li class=md-nav__item> <a href=../PZEM-0XX/ class=md-nav__link> PZEM-0xx power monitor </a> </li> <li class=md-nav__item> <a href=../RCWL-0516/ class=md-nav__link> RCWL-0516 microwave radar motion sensor </a> </li> <li class=md-nav__item> <a href=../RDM6300/ class=md-nav__link> RDM6300 RFID reader </a> </li> <li class=md-nav__item> <a href=../RF-Transciever/ class=md-nav__link> RF Transciever </a> </li> <li class=md-nav__item> <a href=../SDS011/ class=md-nav__link> SDS011 air quality sensor </a> </li> <li class=md-nav__item> <a href=../SHT30/ class=md-nav__link> SHT30 temperature sensor </a> </li> <li class=md-nav__item> <a href=../TX2x/ class=md-nav__link> TX20/TX23 anemometer </a> </li> <li class=md-nav__item> <a href=../TSL2561/ class=md-nav__link> TSL2561 light sensor </a> </li> <li class=md-nav__item> <a href=../VEML6070/ class=md-nav__link> VEML6070 UV light sensor </a> </li> <li class=md-nav__item> <a href=../VEML6075/ class=md-nav__link> VEML6075 UVA/UVB/UVINDEX Sensor </a> </li> <li class=md-nav__item> <a href=../VEML7700/ class=md-nav__link> VEML7700 Ambient light sensor </a> </li> <li class=md-nav__item> <a href=../VL53L0x/ class=md-nav__link> VL53L0X laser ranging module </a> </li> <li class=md-nav__item> <a href=../WS2812B-RGB-Shield/ class=md-nav__link> WS2812B RGB Shield </a> </li> <li class=md-nav__item> <a href=../WS2812B-and-WS2813/ class=md-nav__link> WS2812B and WS2813 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Supported Devices <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Supported Devices" data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"></span> Supported Devices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Configuration-Procedure-for-New-Devices/ class=md-nav__link> Configure Unknown Device </a> </li> <li class=md-nav__item> <a href="https://templates.blakadder.com/ " target='_blank""' class=md-nav__link> All Supported Devices </a> </li> <li class=md-nav__item> <a href=../Pinouts/ class=md-nav__link> Wi-Fi Module Pinouts </a> </li> <li class=md-nav__item> <a href=../Supported-Modules/ class=md-nav__link> Supported Modules </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Help <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Help data-md-level=1> <label class=md-nav__title for=nav-7> <span class="md-nav__icon md-icon"></span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../FAQ/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../Troubleshooting/ class=md-nav__link> Troubleshooting </a> </li> <li class=md-nav__item> <a href=../Device-Recovery/ class=md-nav__link> Device Recovery </a> </li> <li class=md-nav__item> <a href="https://discord.gg/Ks2Kzd4 " target='_blank""' class=md-nav__link> Discord Support </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Builds/ class=md-nav__link> Builds </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#methods-to-temporarly-disable-deepsleep-mode class=md-nav__link> Methods to (temporarly) disable DeepSleep mode </a> <nav class=md-nav aria-label="Methods to (temporarly) disable DeepSleep mode"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#using-a-switch class=md-nav__link> Using a switch </a> </li> <li class=md-nav__item> <a href=#using-mqtt class=md-nav__link> Using MQTT </a> </li> <li class=md-nav__item> <a href=#using-smart-home-automation class=md-nav__link> Using smart home automation </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#driver-writer-executing-commands-before-entering-deepsleep class=md-nav__link> Driver writer: Executing commands before entering DeepSleep </a> </li> <li class=md-nav__item> <a href=#overcome-network-issues class=md-nav__link> Overcome network issues </a> </li> <li class=md-nav__item> <a href=#deepsleep-algorithm-general-timing class=md-nav__link> DeepSleep Algorithm General Timing </a> </li> <li class=md-nav__item> <a href=#esp8266-deepsleep-side-effects class=md-nav__link> ESP8266 DeepSleep Side-effects </a> </li> <li class=md-nav__item> <a href=#log-output-explanation class=md-nav__link> Log Output Explanation </a> </li> <li class=md-nav__item> <a href=#rules-to-adapt-deepsleep-period-to-battery-level class=md-nav__link> Rules to adapt DeepSleep period to battery level. </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/tasmota/docs/blob/master/docs/DeepSleep.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>DeepSleep</h1> <p>DeepSleep support for up to 1 day (i.e., 86,400 secONds) (e.g., if used with KNX) (<a href=../Commands/#deepsleeptime><code>DeepSleepTime</code></a>).</p> <p>The ESP8266 has a limitation of a maximum of ~71 minutes DeepSleep. To overcome the limitation, a short wake-up is performed - the device will wake up every hour for &lt;0.3 seconds until the DeepSleep time is reached. The remaining DeepSleep time is decremented, and the device is then put back in DeepSleep again. The remaining time is stored in RTC memory. As long as the device is powered (e.g., via the battery), this should work fine. Flash memory is not used because of how often this has to occur (every hour) and the time it takes for the flash to be ready takes much longer than the total time to write to the RTC.</p> <p><code>DeepSleepTime</code> sets the time the device remains in DeepSleep before it returns to full operating mode. Once the command is issued, the DeepSleep cycle commences. During DeepSleep, the device is effectively <strong>off</strong> and, as such, it is not possible to modify DeepSleepTime without exiting DeepSleep. </p> <div class="admonition example"> <p class=admonition-title>Example</p> <p>With <code>DeepSleepTime 3600</code>, the device will wake up exactly every hour (e.g., 8:00am, 9:00am, ...). If you define <code>DeepSleepTime 86400</code> (i.e., 60*60*24), it will wake-up exactly at 0:00 UTC time - not your local time. If you define <code>DeepSleepTime 600</code>, it will wake-up every 10 minutes (e.g., 8:00, 8:10, 8:20, ...).</p> </div> <div class="admonition warning"> <p class=admonition-title>Warning</p> </div> <p>Please be aware that the minimum DeepSleep time is 10 seconds.</p> <p><img style=float:right src=../_media/deepsleep_minimal.png> In order for the device to wake itself to perform its function during the DeepSleep cycle, the RST pin must be connected to the D0/GPIO16 pin. This is the only pin which can perform this function as the wake-up signal is sent from the RTC through D0/GPIO16 to RST. When connected to RST for DeepSleep purpose, GPIO16 may not be used for other functions. As such, it is recommended to leave it configured as <code>None (0)</code>. <em>On the diagram, black denotes existing parts and connections on a standard ESP board (mini-D1, NodeMCU, ...). Red denotes what is added to the DeepSleep feature.</em></p> <p><img alt src=../_media/deepsleep_gpio16_none.png></p> <h2 id=methods-to-temporarly-disable-deepsleep-mode>Methods to (temporarly) disable DeepSleep mode<a class=headerlink href=#methods-to-temporarly-disable-deepsleep-mode title="Permanent link">~</a></h2> <h3 id=using-a-switch>Using a switch<a class=headerlink href=#using-a-switch title="Permanent link">~</a></h3> <p><img style=float:right src=../_media/deepsleep_switch.png> Select another GPIO (let's call it "GPIOn") and connect it GND. This can be performed through a switch per the schematic below. Flipping the switch to "ON" will prevent Tasmota to enter DeepSleep again after next wake-up until the switch is flipped back OFF. <em>On the diagram, blue denotes additional parts and connections to be able to disableDeepSleep.</em> GPIOn should be defined as <code>DeepSleep (182)</code> in the configuration as shown below:</p> <p><img alt src=../_media/deepsleep_deepsleep182.png></p> <p>The following GPIOs <strong>CANNOT</strong> be used for the purpose of temporarily disabling DeepSleep as described above:<br> - GPIO16 (because it is connected to RST),<br> - GPIO15 (because of an existing on-board pull-down resistor),<br> - GPIO0 (because pulling it down at wake up will enter serial bootload mode).<br></p> <p>All others GPIO should be acceptable.</p> <p>An interresting use-case is to disable DeepSleep when external power (USB, PSU, solar panel...) is applied to the device using a transistor.</p> <p><img alt="DeepSleep and transistor" src=../_media/deepsleep_transistor.png></p> <p>If the device is not (easily) accessible, methods can be used to disable the DeepSleep loop without physical access.</p> <h3 id=using-mqtt>Using MQTT<a class=headerlink href=#using-mqtt title="Permanent link">~</a></h3> <p>Send a retained <code>DeepSleepTime 0</code> command to your device. As the message is retained in the MQTT broker, the device will receive it as soon as it connectes to the MQTT broker. </p> <div class="admonition example"> <p class=admonition-title>Example: Sending from another Tasmota</p> </div> <p>In another Tasmota console you can type the following command:<br> <code>Publish2 cmnd/%topic%/DeepSleepTime 0</code><br> To clear the retained message, once your device is out of DeepSleep, use:<br> <code>Publish2 cmnd/%topic%/DeepSleepTime</code></p> <div class="admonition example"> <p class=admonition-title>Example: Sending using mosquitto utilities</p> </div> <p>Command to send a retained message:<br> <code>mosquitto_pub -t "cmnd/myDeviceTopic/DeepsleepTime" -r -m "0"</code><br> Remove retained message<br> <code>mosquitto_pub -t "cmnd/myDeviceTopic/DeepsleepTime" -r -n</code><br></p> <p>You can alsosend retained message or clear them with other MQTT tools: MQTT Explorer, ....</p> <p>Once you have made your configuration change, you will need to re-enable DeepSleep mode using <code>DeepSleepTime</code> command.</p> <h3 id=using-smart-home-automation>Using smart home automation<a class=headerlink href=#using-smart-home-automation title="Permanent link">~</a></h3> <p>Configure a settable flag in your home automation hub (e.g., Node-Red, openHAB, Home Assistant). The flag should subscribe to the <code>tele/%topic%/LWT</code> topic for the payload <code>Online</code>. Alternatively, if testing the payload value is not easy, subscribe to the topic <code>tele/%topic%/STATE</code> which is the 2nd topic on which the device publish right after waking-up.</p> <p>The moment a message is received on this topic, the automation can publish a message to topic <code>cmnd/%topic%/DeepSleepTime</code> with payload <code>0</code>. This will cause the device to disable DeepSleep and allow maintenance such as firmware updates to be performed without having an unexpected DeepSleep event. Send the <code>DeepSleepTime 0</code> command <mark>only once</mark>.</p> <p>Once device maintenance is completed, place it back into DeepSleep mode using original configuration.</p> <div class="admonition tip"> <p class=admonition-title>If you're having issues after wakeup from sleep</p> <p>Make sure bootloop detection is off <a href=../Commands/#setoption36><code>SetOption36 0</code></a>. See issue <a href=https://github.com/arendst/Tasmota/issues/6890#issuecomment-552181980>#6890</a></p> </div> <h2 id=driver-writer-executing-commands-before-entering-deepsleep>Driver writer: Executing commands before entering DeepSleep<a class=headerlink href=#driver-writer-executing-commands-before-entering-deepsleep title="Permanent link">~</a></h2> <p>When writing a driver for a sensor, if the sensor supports a low power mode, it is a good practice to process the handler <code>FUNF_BEFORE_DEEPSLEEP</code> to enable the low power mode. When Tasmota will restart at next wake-upn it will automatically re-initialize the sensor.</p> <p>You can also execute any command or special script <mark>BEFORE</mark> device goes into DeepSleep using handler FUNC_SAVE_BEFORE_RESTART as a predefined hook to implement your own procedure. This requires you to code your own function and self-compile custom firmware.</p> <p>To use rules, use the <code>System#Save</code> trigger. This will be executed just before the device goes into DeepSleep.</p> <h2 id=overcome-network-issues>Overcome network issues<a class=headerlink href=#overcome-network-issues title="Permanent link">~</a></h2> <p>If all requirements (Wifi, NTP time synchronization, MQTT broker connection and TelePeriod) are not met, the device will stay awake while trying to attain the remaining requirements. On battery powered devices this behavior is undesirable because it will quickly deplete the battery. To avoid this when these requirements cannot be met, put the device back into DeepSleep for an hour. Do this through a rule that will be triggered 30 seconds after reboot and sends the device into deepsleep for an hour.</p> <div class=highlight><pre><span></span><code><span class=go>Rule1</span>
<span class=go>  ON Dimmer#Boot DO RuleTimer1 30 ENDON</span>
<span class=go>  ON Rules#Timer=1 DO DeepSleepTime 3600 ENDON</span>

<span class=go>Rule1 ON</span>
</code></pre></div> <h2 id=deepsleep-algorithm-general-timing>DeepSleep Algorithm General Timing<a class=headerlink href=#deepsleep-algorithm-general-timing title="Permanent link">~</a></h2> <p>Let's assume you have set <code>DeepSleepTime 3600</code> (one hour) and <code>TelePeriod 300</code> (five minutes). The device will first wake at 8:00 am. The device will boot and connect Wi-Fi. Next, the correct time must be sync'ed from one of the NTP servers. Now the device has all prerequisites for going into DeepSleep.</p> <p>DeepSleep is then triggered at the TelePeriod event. In this example, it will occur after five minutes. Telemetry will be collected and sent (e.g., via MQTT). Now, DeepSleep can happen. First, <code>Offline</code> is published to the LWT topic on MQTT. It then calculates the new sleeping time to wake-up at 9:00 am (3600 seconds after the last wake-up). At 9:00 am this same sequence of events happens again.</p> <p>If you want to minimize the time that the device is in operation, decrease TelePeriod down to 10 seconds. This period of time is counted <mark>after</mark> MQTT is connected. Also, in this case, the device will wake up at 9:00 am even if the uptime was much smaller. If the device missed a wake-up it will try a start at the next event - in this case 10:00 am.</p> <h2 id=esp8266-deepsleep-side-effects>ESP8266 DeepSleep Side-effects<a class=headerlink href=#esp8266-deepsleep-side-effects title="Permanent link">~</a></h2> <p>Not all GPIO behave the same during DeepSleep. Some GPIO go HIGH, some LOW, some FOLLOW the relay but work only on FET transistors. As soon as current flows they go LOW. I use one GPIO to trigger a BC337 transistor to switch OFF all connected devices during DeepSleep.</p> <p>Findings:</p> <table> <thead> <tr> <th>Pin</th> <th align=center>GPIO</th> <th>Behavior</th> </tr> </thead> <tbody> <tr> <td>D0</td> <td align=center>16</td> <td>Excluded due to use as wake-up pin</td> </tr> <tr> <td>D1</td> <td align=center>5</td> <td>KEEP STATE, go LOW if resistance to ground &lt; infinite</td> </tr> <tr> <td>D2</td> <td align=center>4</td> <td>KEEP STATE, go LOW if resistance to ground &lt; infinite</td> </tr> <tr> <td>D3</td> <td align=center>0</td> <td>HIGH</td> </tr> <tr> <td>D4</td> <td align=center>2</td> <td>HIGH</td> </tr> <tr> <td>D5</td> <td align=center>14</td> <td>HIGH, go LOW if resistance to ground &lt; infinite</td> </tr> <tr> <td>D6</td> <td align=center>12</td> <td>HIGH, go LOW if resistance to ground &lt; infinite</td> </tr> <tr> <td>D7</td> <td align=center>13</td> <td>HIGH, go LOW if resistance to ground &lt; infinite</td> </tr> <tr> <td>D8</td> <td align=center>15</td> <td>LOW</td> </tr> </tbody> </table> <h2 id=log-output-explanation>Log Output Explanation<a class=headerlink href=#log-output-explanation title="Permanent link">~</a></h2> <p><em>(logging level <code>4</code>)</em></p> <p>When MQTT connects at <code>13:08:38</code>, this sets the system to READY. <div class=highlight><pre><span></span><code>13:08:43 MQT: tele/tasmota/INFO3 = {&quot;RestartReason&quot;:&quot;Deep-Sleep Wake&quot;}
13:08:44 APP: Boot Count 3
13:08:44 CFG: Saved to flash at F4, Count 96, Bytes 3824
</code></pre></div></p> <p>In the context of DeepSleep, maintaining a device boot count is not relevant. When DeepSleep is enabled, boot count will not be incremented. This avoids excessive flash writes which will deteriorate the flash memory chip and eventually cause the device to fail. Boot count incrementing can be enabled using <a href=../Commands/#setoption76><code>SetOption76</code></a>.</p> <p>In this example, TelePeriod is 10. Therefore when it is reached, telemetry reporting occurs. <div class=highlight><pre><span></span><code>13:08:48 MQT: tele/tasmota/STATE = {&quot;Time&quot;:&quot;2019-09-04T13:08:48&quot;,&quot;Epoch&quot;:1567595328,&quot;Uptime&quot;:&quot;0T00:00:14&quot;,&quot;UptimeSec&quot;:14,&quot;Heap&quot;:24,&quot;SleepMode&quot;:&quot;Dynamic&quot;,&quot;Sleep&quot;:50,&quot;LoadAvg&quot;:20,&quot;MqttCount&quot;:1,&quot;Wifi&quot;:{&quot;AP&quot;:1,&quot;SSId&quot;:&quot;MyWLAN&quot;,&quot;BSSId&quot;:&quot;AA:FF:AA:AA:AA:AA&quot;,&quot;Channel&quot;:11,&quot;RSSI&quot;:100,&quot;LinkCount&quot;:1,&quot;Downtime&quot;:&quot;0T00:00:08&quot;,&quot;DeepSleep&quot;:300,&quot;Heap&quot;:25160}}
13:08:48 MQT: tele/tasmota/SENSOR = {&quot;Time&quot;:&quot;2019-09-04T13:08:48&quot;,&quot;Epoch&quot;:1567595328,&quot;ANALOG&quot;:{&quot;A0&quot;:8}}
</code></pre></div></p> <p>Date and time is set, status and telemetry sent. Now start shutdown procedure.</p> <p>First, send MQTT offline. <code>13:08:48 MQT: state/sonoff/LWT = Offline</code></p> <p>DeepSleep is 300 seconds. Therefore +-30 sec is allowed as deviation between proposed wake-up time and real wake-up time. Reporting in 0.1sec. In this case wake-up was one second late. <code>13:08:48 Timeslip 0.1 sec:? -300 &lt; -10 &lt; 300</code></p> <p>If the error is in the range, this is tagged as a normal wake up where drift can be recalculated <code>13:08:48 Normal deepsleep? 1</code></p> <p>Recalculate a new drift that is a multiplier for the next wake-up in 1/10000. In this case, the multiplier is 1.0257 <code>13:08:48 % RTC new drift 10257</code></p> <p>And for information: New target wake-up time <code>13:08:48 Next wakeup 2019-09-04T13:10:00</code></p> <p>Based on run time and the error in the last loop, a new sleeping time will be calculated. This will be multiplied by the <code>deepsleep_slip</code> and, ideally, the device will wake up at the time above. <code>13:08:48 Sleeptime 285 sec, deepsleep_slip 10257</code></p> <p>The effectiveness of the compensation can be seen here. Instead of typically 160-200 seconds, most times it is better than 10 seconds in a one hour DeepSleep cycle.</p> <p><img alt=TempComp src=https://raw.githubusercontent.com/stefanbode/stefanbode.github.io/master/images/deepsleep_comp.png></p> <h2 id=rules-to-adapt-deepsleep-period-to-battery-level>Rules to adapt DeepSleep period to battery level.<a class=headerlink href=#rules-to-adapt-deepsleep-period-to-battery-level title="Permanent link">~</a></h2> <p>In some applications, it is interresting to adjust the DeepSleep period to the level of the battery. For this, we consider that:</p> <ul> <li>the battery level is measured by the ESP ADC with the appropriate voltage divider,</li> <li>the Tasmota ADC mode is set to Range mode,</li> <li><code>AdcParams 6</code> has been used so the range value represent the battery voltage in millivolts </li> </ul> <p>The below graph represent the adaptation paths we want to follow to adjust DeepSleepTime: one path while the level is dropping, another path while the level is rising.</p> <p><img alt="DeepSleep adjust graph" src=../_media/depsleep_adjust_graph.png></p> <p>To implement this in Tasmota we can use <a href=../Rules/ >Rules</a>. As Rules do not provide an AND operator, we also need the optional <code>IF</code> feature. This requires to <a href=../Compile-your-build/ >compile a customized firmware</a> with the following items in <code>user_config_override.h</code>:</p> <div class=highlight><pre><span></span><code><span class=cp>#define USE_RULES</span>
<span class=cp>#define SUPPORT_IF_STATEMENT</span>
</code></pre></div> <p>First, we need to know the current value of DeepSleepTime. Values for internal settings are not available as %variable% but they can generally be obtained by sending the command and capturing the result with a rule. To get the current value of DeepSleepTime, we need a trigger early in the boot process. For example <code>Wifi#Connected</code>.</p> <p>Our first rules to get the current DeepSleepTime into %var1% would be:</p> <div class=highlight><pre><span></span><code>ON Wifi#Connected DO Backlog DeepSleepTime ENDON
ON DeepSleepTime#Data DO var1 %value% ENDON
</code></pre></div> <p>The best moment to compare the batery level and decide if it is necessary to change the DeepSleepTime is right after the TelePeriod SENSOR message has been sent, which is just before Tasmota calculate the next wake-up time. So we can use <code>tele-ANALOG#Range</code> as a trigger for our rules. Using BREAK allows to compare the trigger only to the upper value of the segment and stop further rules evaluations if the comparison is met. In the rule statement for a given battery level, we compare the current value of DeepSleepTime (which is %var1%) with the value we vant (given by the graph). If the current value is lower than the value we want, we are on the decreasing path and we can apply the new value. If the current value is greater than the value we want, we are on the rising path and we can apply the new value.</p> <p><img alt="DeepSleep adjust rules" src=../_media/deepsleep_adjust_rules.png></p> <p>All above can be set into Rule1. As it is a long command, it may be necessary to enter the rule in 2 parts (note the usage of the <code>+</code>) :</p> <div class=highlight><pre><span></span><code>Rule1 on Wifi#Connected do backlog deepsleeptime endon on deepsleeptime#data do var1 %value% endon on tele-Analog#Range&lt;3450 do if (%var1%&lt;3600) deepsleeptime 3600 endif break on tele-Analog#Range&lt;3650 do if (%var1%&lt;1800) deepsleeptime 1800 endif break 
Rule1 +on tele-Analog#Range&lt;3800 do if (%var1%&lt;900) deepsleeptime 900 elseif (%var1%&gt;1800) deepsleeptime 1800 endif break on tele-Analog#Range&lt;4000 do if (%var1%&gt;900)deepsleeptime 900 endif break on tele-Analog#Range&gt;=4000 do if (%var1%&gt; 600) deepsleeptime 600 endif endon
</code></pre></div> <p>Don't forget to enable using <code>Rule1 1</code></p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../Buttons-and-Switches/ class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Buttons and Switches </div> </div> </a> <a href=../Device-Groups/ class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Device Groups </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://discord.gg/Ks2Kzd4 target=_blank rel=noopener title=discord.gg class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M297.216 243.2c0 15.616-11.52 28.416-26.112 28.416-14.336 0-26.112-12.8-26.112-28.416s11.52-28.416 26.112-28.416c14.592 0 26.112 12.8 26.112 28.416zm-119.552-28.416c-14.592 0-26.112 12.8-26.112 28.416s11.776 28.416 26.112 28.416c14.592 0 26.112-12.8 26.112-28.416.256-15.616-11.52-28.416-26.112-28.416zM448 52.736V512c-64.494-56.994-43.868-38.128-118.784-107.776l13.568 47.36H52.48C23.552 451.584 0 428.032 0 398.848V52.736C0 23.552 23.552 0 52.48 0h343.04C424.448 0 448 23.552 448 52.736zm-72.96 242.688c0-82.432-36.864-149.248-36.864-149.248-36.864-27.648-71.936-26.88-71.936-26.88l-3.584 4.096c43.52 13.312 63.744 32.512 63.744 32.512-60.811-33.329-132.244-33.335-191.232-7.424-9.472 4.352-15.104 7.424-15.104 7.424s21.248-20.224 67.328-33.536l-2.56-3.072s-35.072-.768-71.936 26.88c0 0-36.864 66.816-36.864 149.248 0 0 21.504 37.12 78.08 38.912 0 0 9.472-11.52 17.152-21.248-32.512-9.728-44.8-30.208-44.8-30.208 3.766 2.636 9.976 6.053 10.496 6.4 43.21 24.198 104.588 32.126 159.744 8.96 8.96-3.328 18.944-8.192 29.44-15.104 0 0-12.8 20.992-46.336 30.464 7.68 9.728 16.896 20.736 16.896 20.736 56.576-1.792 78.336-38.912 78.336-38.912z"/></svg> </a> <a href=https://t.me/tasmota target=_blank rel=noopener title=t.me class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"/></svg> </a> <a href=https://github.com/tasmota target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/vendor.18f0862e.min.js></script> <script src=../assets/javascripts/bundle.994580cf.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "..",
          features: ['navigation.tabs', 'navigation.instant', 'navigation.tabs.sticky'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>